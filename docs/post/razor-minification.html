<!DOCTYPE html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Razor Compile-time Minification for ASP.NET Core 2.0</title><meta name=description content="Learn how to use the extensibility features of the Razor engine in ASP.NET Core 2.0 to minify Razor Pages and MVC Razor Views at compile time."><meta property=og:locale content=en><meta property=og:site_name content="the guardrex chew"><meta property=og:title content="Razor Compile-time Minification for ASP.NET Core 2.0"><link rel=canonical href="http://www.guardrex.com/"><meta property=og:url content="http://www.guardrex.com/"><meta name=twitter:site content=@guardrex><meta name=twitter:title content="Razor Compile-time Minification for ASP.NET Core 2.0"><meta name=twitter:description content="Learn how to use the extensibility features of the Razor engine in ASP.NET Core 2.0 to minify Razor Pages and MVC Razor Views at compile time."><meta name=twitter:url content="http://www.guardrex.com/"><meta name=twitter:card content=summary><meta name=twitter:image content=http://rexsite.azureedge.net/image/twitter600x335.png><meta property=og:image content=http://rexsite.azureedge.net/image/og.png><link rel=apple-touch-icon sizes=57x57 href=http://rexsite.azureedge.net/image/apple-touch-icon-57x57.png><link rel=apple-touch-icon sizes=114x114 href=http://rexsite.azureedge.net/image/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=72x72 href=http://rexsite.azureedge.net/image/apple-touch-icon-72x72.png><link rel=apple-touch-icon sizes=144x144 href=http://rexsite.azureedge.net/image/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=60x60 href=http://rexsite.azureedge.net/image/apple-touch-icon-60x60.png><link rel=apple-touch-icon sizes=120x120 href=http://rexsite.azureedge.net/image/apple-touch-icon-120x120.png><link rel=apple-touch-icon sizes=76x76 href=http://rexsite.azureedge.net/image/apple-touch-icon-76x76.png><link rel=apple-touch-icon sizes=152x152 href=http://rexsite.azureedge.net/image/apple-touch-icon-152x152.png><link rel=icon type=image/png href=http://rexsite.azureedge.net/image/favicon-196x196.png sizes=196x196><link rel=icon type=image/png href=http://rexsite.azureedge.net/image/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=http://rexsite.azureedge.net/image/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=http://rexsite.azureedge.net/image/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=http://rexsite.azureedge.net/image/favicon-128.png sizes=128x128><meta name=application-name content="the guardrex chew"><meta name=msapplication-TileColor content=#FFFFFF><meta name=msapplication-TileImage content=http://rexsite.azureedge.net/image/mstile-144x144.png><meta name=msapplication-square70x70logo content=http://rexsite.azureedge.net/image/mstile-70x70.png><meta name=msapplication-square150x150logo content=http://rexsite.azureedge.net/image/mstile-150x150.png><meta name=msapplication-wide310x150logo content=http://rexsite.azureedge.net/image/mstile-310x150.png><meta name=msapplication-square310x310logo content=http://rexsite.azureedge.net/image/mstile-310x310.png><meta name=msapplication-notification content="polling-uri=http://www.guardrex.com/rss.xml"><style>body{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:17px;line-height:1.5;color:#445;margin:0;background:url(http://rexsite.azureedge.net/image/logo-head3.png) no-repeat left top fixed}h1,h2,h3,h4,h5,h6{font-weight:500;line-height:1.1;margin-top:10px;margin-bottom:10px}h1{font-size:28px}h2{font-size:26px}h3{font-size:22px}.container{padding:0 15px;margin:0 auto;max-width:1000px;background-color:#fff;opacity:0.95}row{margin-right:-15px;margin-left:-15px}p{margin:0 0 10px}a{color:#337ab7;text-decoration:none}a:hover,a:focus{text-decoration:underline}img{vertical-align:middle;border:0;opacity:1;transition:opacity 0.3s}img[data-src]{opacity:0}.btn{display:inline-block;padding:6px 12px;margin-bottom:0;font-size:14px;font-weight:400;line-height:1.5;text-align:center;white-space:nowrap;vertical-align:middle;cursor:pointer;background-image:none;border:1px solid #ccc;border-radius:4px;color:#333}.btn:hover,.btn:focus,.btn.focus{background-color:#eee;text-decoration:none}ol li{margin:20px 0 20px -25px}table th{text-align:center;border-bottom:1px solid gray}table td:not(:first-child){padding-left:10px}#social_top,#social_bottom td{padding-top:10px}.note,.tip,.warning{border:1px solid gray;padding:10px;margin:10px 0}.note em,.tip em,.warning em{font-size:1.4em}.warning em{color:red}#title{line-height:57px;font-size:36px}#author{font-size:14px;margin-top:5px}@media (max-width:600px){#title,h2{font-size:26px}}@media (max-width:490px){#title,h2{font-size:20px}}@media (max-width:420px){#logo{width:40px;height:40px}#title{font-size:16px;line-height:40px}#author{font-size:12px;margin-top:0}}.nostyle,.nostyle:hover{color:black}code[class*="language-"],pre[class*="language-"]{color:black;background:none;text-shadow:0 1px white;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;text-align:left;word-break:break-all;word-wrap:break-word;white-space:pre-wrap;word-spacing:normal;line-height:1.5;tab-size:4;hyphens:none}@media print{code[class*="language-"],pre[class*="language-"]{text-shadow:none}}pre[class*="language-"]{padding:1em;margin:.5em 0;overflow:auto}:not(pre) > code[class*="language-"],pre[class*="language-"]{background:#F6F6F6;border:1px solid #888;border-radius:.3em}:not(pre) > code[class*="language-"]{padding:.1em;white-space:normal}.token.comment,.token.prolog,.token.doctype,.token.cdata{color:slategray}.token.punctuation{color:#999}.namespace{opacity:.7}.token.property,.token.tag,.token.boolean,.token.number,.token.constant,.token.symbol,.token.deleted{color:#905}.token.selector,.token.attr-name,.token.string,.token.char,.token.builtin,.token.inserted{color:#690}.token.operator,.token.entity,.token.url,.language-css .token.string,.style .token.string{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#DD4A68}.token.regex,.token.important,.token.variable{color:#e90}.token.important,.token.bold{font-weight:bold}.token.italic{font-style:italic}.token.entity{cursor:help}</style><script>var _gaq=_gaq||[];_gaq.push(['_setAccount','UA-48425827-1']);_gaq.push(['_trackPageview']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src='https://ssl.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();</script><div class=container><header><div id=header_container class=container style="border-bottom:1px solid lightgray;cursor:pointer"><div id=author style=float:right;font-style:italic;text-align:right>Luke Latham<br> <a href=https://twitter.com/guardrex>@guardrex</a></div><a href="/" class=nostyle style=text-decoration:none> <img id=logo src=http://rexsite.azureedge.net/image/apple-touch-icon-57x57.png alt="guardrex logo" width=57 height=57 style=float:left><div id=title style=color:green;font-family:courier;margin:0>the guardrex chew</div></a></div></header><table id=social_top><tbody><tr><td><a href="https://twitter.com/home?status=Check%20out%20%40guardrex%20blog%20post%20Razor%20Compile%2Dtime%20Minification"><svg role=img aria-labelledby="twitter twitter_desc" height=28 width=28 xmlns=http://www.w3.org/2000/svg viewBox="0 0 28 28"><title id=twitter>Tweet</title><desc id=twitter_desc>Share on Twitter</desc><path fill=#26c4f1 d="M24.253 8.756C24.69 17.08 18.297 24.182 9.97 24.62a15.093 15.093 0 0 1-8.86-2.32c2.702.18 5.375-.648 7.507-2.32a5.417 5.417 0 0 1-4.49-3.64c.802.13 1.62.077 2.4-.154a5.416 5.416 0 0 1-4.412-5.11 5.43 5.43 0 0 0 2.168.387A5.416 5.416 0 0 1 2.89 4.498a15.09 15.09 0 0 0 10.913 5.573 5.185 5.185 0 0 1 3.434-6.48 5.18 5.18 0 0 1 5.546 1.682 9.076 9.076 0 0 0 3.33-1.317 5.038 5.038 0 0 1-2.4 2.942 9.068 9.068 0 0 0 3.02-.85 5.05 5.05 0 0 1-2.48 2.71z" /></svg></a><td><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A//www.guardrex.com/post/razor-minification.html"><svg role=img aria-labelledby="facebook facebook_desc" height=29 width=29 xmlns=http://www.w3.org/2000/svg viewBox="0 0 29 29"><title id=facebook>Facebook</title><desc id=facebook_desc>Share on Facebook</desc><path fill=#306199 d="M26.4 0H2.6C1.714 0 0 1.715 0 2.6v23.8c0 .884 1.715 2.6 2.6 2.6h12.393V17.988h-3.996v-3.98h3.997v-3.062c0-3.746 2.835-5.97 6.177-5.97 1.6 0 2.444.173 2.845.226v3.792H21.18c-1.817 0-2.156.9-2.156 2.168v2.847h5.045l-.66 3.978h-4.386V29H26.4c.884 0 2.6-1.716 2.6-2.6V2.6c0-.885-1.716-2.6-2.6-2.6z" /></svg></a><td><a href="https://plus.google.com/share?url=http%3A//www.guardrex.com/post/razor-minification.html"><svg role=img aria-labelledby="google google_desc" xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 0 24 24"><title id=google>Google+</title><desc id=google_desc>Share on Google+</desc><path fill=#e93f2e d="M21 8.29h-1.95v2.6h-2.6v1.82h2.6v2.6H21v-2.6h2.6v-1.885H21V8.29zM7.614 10.306v2.925h3.9c-.26 1.69-1.755 2.925-3.9 2.925-2.34 0-4.29-2.016-4.29-4.354s1.885-4.353 4.29-4.353c1.104 0 2.014.326 2.794 1.105l2.08-2.08c-1.3-1.17-2.924-1.883-4.874-1.883C3.65 4.586.4 7.835.4 11.8s3.25 7.212 7.214 7.212c4.224 0 6.953-2.988 6.953-7.082 0-.52-.065-1.104-.13-1.624H7.614z"></path></svg></a><td><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3A//www.guardrex.com/post/razor-minification.html&amp;title=Razor%20Compile%2Dtime%20Minification%20for%20ASP%2ENET%20Core%202%2E0&amp;summary=Check%20out%20%40guardrex%20blog%20post%20Razor%20Compile%2Dtime%20Minification&amp;source=!social_source"><svg role=img aria-labelledby="linkedin linkedin_desc" xmlns=http://www.w3.org/2000/svg width=28 height=28 viewBox="0 0 28 28"><title id=linkedin>Linkedin</title><desc id=linkedin_desc>Share on Linkedin</desc><path fill=#007bb6 d="M25.424 15.887v8.447h-4.896v-7.882c0-1.98-.71-3.33-2.48-3.33-1.354 0-2.158.91-2.514 1.802-.13.315-.162.753-.162 1.194v8.216h-4.9s.067-13.35 0-14.73h4.9v2.087c-.01.017-.023.033-.033.05h.032v-.05c.65-1.002 1.812-2.435 4.414-2.435 3.222 0 5.638 2.106 5.638 6.632zM5.348 2.5c-1.676 0-2.772 1.093-2.772 2.54 0 1.42 1.066 2.538 2.717 2.546h.032c1.71 0 2.77-1.132 2.77-2.546C8.056 3.593 7.02 2.5 5.344 2.5h.005zm-2.48 21.834h4.896V9.604H2.867v14.73z"></path></svg></a></table><article><h1>Razor Compile-time Minification for ASP.NET Core 2.0</h1><p>By: Luke Latham (@guardrex)<br><em>Published:</em> 8/13/2017 <em>Last updated:</em> 10/1/2017<p>Learn how to use the extensibility features of the Razor engine in ASP.NET Core 2.0 to minify Razor Pages and MVC Razor Views at compile time.<p>In this article:<ul><li><a href=#introduction>Introduction</a><li><a href=#prerequisites>Prerequisites</a><li><a href=#sample-app>Sample App</a><li><a href=#the-setup>The Setup</a><li><a href=#additional-resources>Additional Resources</a><li><a href=#acknowledgements>Acknowledgements</a></ul><a id=introduction></a><h2><svg aria-hidden=true height=16 version=1.1 viewbox="0 0 16 16" width=16><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg> <a href=#introduction class=nostyle>Introduction</a></h2><p>Compile-time minification of markup with Razor in ASP.NET Core 1.x has been possible but only with difficulty. In the 1.x release, there's no easy way to plug in a third-party minification library so that markup from a View file can be intercepted prior to the Razor engine processing it. Because there isn't a simple extensibility point to intercept View content, you're left the the challenge of replacing a large amount of the Razor engine. To minify the content, you work with the "chunks" of markup that the Razor engine uses, which are convienant for the Razor engine to process but difficult to manage for markup minification.<p>With the ASP.NET Core 2.0 Razor engine, the situation is <em>much</em> improved. An extensibility point is present that permits you to simply intercept View (or Razor Page) file content, minify the content, and pass the content on to the Razor engine for processing.</p><a id=prerequisites></a><h2><svg aria-hidden=true height=16 version=1.1 viewbox="0 0 16 16" width=16><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg> <a href=#prerequisites class=nostyle>Prerequisites</a></h2><ul><li>.NET Core SDK 2.0 or later</ul><a id=sample-app></a><h2><svg aria-hidden=true height=16 version=1.1 viewbox="0 0 16 16" width=16><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg> <a href=#sample-app class=nostyle>Sample App</a></h2><p>Download a fully working sample to accompany this post from the <a href=https://github.com/guardrex/RazorMinification>guardrex/RazorMinification repo</a> at GitHub.</p><a id=the-setup></a><h2><svg aria-hidden=true height=16 version=1.1 viewbox="0 0 16 16" width=16><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg> <a href=#the-setup class=nostyle>The Setup</a></h2><p>First, choose a 3rd party library that's capable of markup minification. This demo uses <a href="https://www.nuget.org/packages/WebMarkupMin.Core/">WebMarkupMin.Core</a> (<a href=https://github.com/Taritsyn/WebMarkupMin>GitHub</a>) by Andrey Taritsyn (<a href=https://github.com/Taritsyn>GitHub</a>, <a href="https://taritsyn.wordpress.com/">Blog</a>, <a href=https://twitter.com/andrey_taritsyn>Twitter</a>). <code class=language-csharp>WebMarkupMin.Core</code> is a good choice because it minifies both the markup and inlined styles and scripts.<p>Replace the <code class=language-csharp>RazorTemplateEngine</code> overriding the <code class=language-csharp>CreateCodeDocument</code> method (<a href=https://github.com/aspnet/Razor/blob/dev/src/Microsoft.AspNetCore.Razor.Language/RazorTemplateEngine.cs#L140-L156>ref source</a>) with an implementation that performs the following work:<ul><li>Setup a <code class=language-csharp>StreamReader</code> to read the View (or Razor Page) file contents.<li>Split the Razor directives from the content.<li>Pass the content to your minfication method.<li>Reassemble the Razor directives and minified markup.<li>Convert the content back into a byte array and use a <code class=language-csharp>MemoryStream</code> to return it to the Razor engine for processing.</ul><p>Here's a complete sample implementation:<pre class=language-csharp><code>using System;
using System.Collections.Generic;
using System.IO;
using System.Text;
using System.Text.RegularExpressions;
using Microsoft.AspNetCore.Razor.Language;
using WebMarkupMin.Core;

public class CustomRazorTemplateEngine : RazorTemplateEngine
{
	// If pages fail due to missing attribute quotes, add:
	//
	// AttributeQuotesRemovalMode = HtmlAttributeQuotesRemovalMode.KeepQuotes,
	//
	// to the HtmlMinificationSettings.
	private HtmlMinifier _htmlMinifier = new HtmlMinifier(new HtmlMinificationSettings() {
		RemoveOptionalEndTags = false,
	});

	public CustomRazorTemplateEngine(RazorEngine engine, RazorProject project) : 
		base(engine, project)
	{
		Options.ImportsFileName = "_ViewImports.cshtml";
		Options.DefaultImports = GetDefaultImports();
	}

	public override RazorCodeDocument CreateCodeDocument(RazorProjectItem projectItem)
	{
		if (projectItem == null)
		{
			throw new ArgumentNullException($"{nameof(projectItem)} is null!");
		}

		if (!projectItem.Exists)
		{
			throw new InvalidOperationException($"{nameof(projectItem)} doesn't exist!");
		}

		Console.WriteLine();
		Console.WriteLine($"File: {projectItem.FileName}");

		using (var inputStream = projectItem.Read())
		{
			using (var reader = new StreamReader(inputStream))
			{
				var text = reader.ReadToEnd();

				if (projectItem.FileName != "_ViewStart.cshtml" &amp;&amp; projectItem.FileName != "_ViewImports.cshtml")
				{
					var markup = string.Empty;
					var directives = string.Empty;
					var markupStart = text.IndexOf("\r\n&lt;");
					if (markupStart != -1)
					{
						directives = text.Substring(0, markupStart + 2);
						markup = text.Substring(markupStart + 2);
					}
					else
					{
						markup = text;
					}
					text = directives + Minify(markup);
				}

				var byteArray = Encoding.UTF8.GetBytes(text);
				var minifiedInputStream = new MemoryStream(byteArray);

				var source = RazorSourceDocument.ReadFrom(minifiedInputStream, projectItem.PhysicalPath);
				var imports = GetImports(projectItem);

				return RazorCodeDocument.Create(source, imports);
			}
		}
	}

	private string Minify(string markup)
	{
		MarkupMinificationResult result = 
			_htmlMinifier.Minify(markup, string.Empty, Encoding.UTF8, true);
		
		if (result.Errors.Count == 0)
		{
			MinificationStatistics statistics = result.Statistics;
			if (statistics != null)
			{
				Console.WriteLine();
				Console.WriteLine($"Original size: {statistics.OriginalSize:N0} Bytes | Minified size: {statistics.MinifiedSize:N0} Bytes | Saved: {statistics.SavedInPercent:N2}%");
			}
			//Console.WriteLine($"{Environment.NewLine}Minified content:{Environment.NewLine}{Environment.NewLine}{result.MinifiedContent}");

			return result.MinifiedContent;
		}
		else
		{
			IList&lt;MinificationErrorInfo&gt; errors = result.Errors;

			Console.WriteLine();
			Console.WriteLine($"Found {errors.Count:N0} error(s):");

			foreach (var error in errors)
			{
				Console.WriteLine($" - Line {error.LineNumber}, Column {error.ColumnNumber}: {error.Message}");
			}

			return markup;
		}
	}

	private static RazorSourceDocument GetDefaultImports()
	{
		using (var stream = new MemoryStream())
		using (var writer = new StreamWriter(stream, Encoding.UTF8))
		{
			writer.WriteLine("@using System");
			writer.WriteLine("@using System.Collections.Generic");
			writer.WriteLine("@using System.Linq");
			writer.WriteLine("@using System.Threading.Tasks");
			writer.WriteLine("@using Microsoft.AspNetCore.Mvc");
			writer.WriteLine("@using Microsoft.AspNetCore.Mvc.Rendering");
			writer.WriteLine("@using Microsoft.AspNetCore.Mvc.ViewFeatures");
			writer.WriteLine("@inject global::Microsoft.AspNetCore.Mvc.Rendering.IHtmlHelper<tmodel> Html");
			writer.WriteLine("@inject global::Microsoft.AspNetCore.Mvc.Rendering.IJsonHelper Json");
			writer.WriteLine("@inject global::Microsoft.AspNetCore.Mvc.IViewComponentHelper Component");
			writer.WriteLine("@inject global::Microsoft.AspNetCore.Mvc.IUrlHelper Url");
			writer.WriteLine("@inject global::Microsoft.AspNetCore.Mvc.ViewFeatures.IModelExpressionProvider ModelExpressionProvider");
			writer.WriteLine("@addTagHelper Microsoft.AspNetCore.Mvc.Razor.TagHelpers.UrlResolutionTagHelper, Microsoft.AspNetCore.Mvc.Razor");
			writer.WriteLine("@addTagHelper Microsoft.AspNetCore.Mvc.Razor.TagHelpers.HeadTagHelper, Microsoft.AspNetCore.Mvc.Razor");
			writer.WriteLine("@addTagHelper Microsoft.AspNetCore.Mvc.Razor.TagHelpers.BodyTagHelper, Microsoft.AspNetCore.Mvc.Razor");
			writer.Flush();

			stream.Position = 0;
			return RazorSourceDocument.ReadFrom(stream, fileName: null, encoding: Encoding.UTF8);
		}
	}
}</tmodel></code></pre><p>Finally, wire up the Razor engine replacement when you build the host:<pre class=language-csharp><code>using Microsoft.AspNetCore;
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Razor.Language;
using Microsoft.Extensions.DependencyInjection;

namespace RazorMinification
{
	public class Program
	{
		public static void Main(string[] args)
		{
			BuildWebHost(args).Run();
		}
			
		public static IWebHost BuildWebHost(string[] args) =&gt;
			WebHost.CreateDefaultBuilder(args)
				.ConfigureServices(services =&gt;
				{
					services.AddMvc();
					services.AddSingleton&lt;RazorTemplateEngine, CustomRazorTemplateEngine&gt;();
				})
				.Configure(app =&gt;
				{
					app.UseDeveloperExceptionPage();
					app.UseMvcWithDefaultRoute();
					app.UseStaticFiles();
				})
				.Build();
	}
}</code></pre><p><code class=language-csharp>WebMarkupMin.Core</code> isn't so good at parsing Razor code in a Razor View or Page, so see the <em>Index.cshtml</em> Razor Page below and note how sections of Razor code are escaped from <code class=language-csharp>WebMarkupMin.Core</code> by placing the code inside of escape tags:<pre class=language-markup><code>&lt;!--wmm:ignore--&gt;...&lt;!--/wmm:ignore--&gt;</code></pre><p>Also note that the use of <code class=language-markup>&lt;text&gt;</code> tags prevents extra spaces and newlines from the Razor line transitions from making their way into the rendered markup.<pre class=language-markup><code>@page
@model IndexModel
@inject Microsoft.AspNetCore.Hosting.IHostingEnvironment Host
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
	&lt;title&gt;Razor Pages Minification App&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;h1&gt;Razor Pages Minification App&lt;/h1&gt;
	&lt;p&gt;@Host.ApplicationName @Model.DT&lt;/p&gt;
	&lt;figure style="text-align:center;width:400px"&gt;
		&lt;img alt="Jack Burton" src="image.png"&gt;
		&lt;figcaption&gt;
			Jack Burton (Kurt Russell)&lt;br&gt;
			&lt;em&gt;Big Trouble in Little China&lt;/em&gt;&lt;br&gt;
			&copy;1986 
			&lt;a href="http://www.foxmovies.com/"&gt;
				20th Century Fox
			&lt;/a&gt;
		&lt;/figcaption&gt;
	&lt;/figure&gt;
	&lt;p&gt;
		People:
		&lt;ol&gt;
			&lt;!--wmm:ignore--&gt;@for (var i = 0; i &lt; Model.People.Count; i++)
			{
				var person = Model.People[i];
				&lt;text&gt;&lt;li&gt;@person&lt;/li&gt;&lt;/text&gt;
			}&lt;!--/wmm:ignore--&gt;
		&lt;/ol&gt;
	&lt;/p&gt;
	&lt;p&gt;
		&lt;!--wmm:ignore--&gt;@if (Model.People.Count &lt; 10)
		{
			&lt;text&gt;There are less than ten people.&lt;/text&gt;
		}&lt;!--/wmm:ignore--&gt;
	&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre><p>The final rendered output is minified:<pre class=language-markup><code>&lt;!DOCTYPE html&gt;&lt;html lang=en&gt;&lt;head&gt;&lt;title&gt;Razor Pages Minification App&lt;/title&gt;&lt;body&gt;&lt;h1&gt;Razor Pages Minification App&lt;/h1&gt;&lt;p&gt;RazorMinification 8/14/2017 4:24:29 PM&lt;/p&gt;&lt;figure style=text-align:center;width:400px&gt;&lt;img alt="Jack Burton" src=image.png&gt;&lt;figcaption&gt;Jack Burton (Kurt Russell)&lt;br&gt;&lt;em&gt;Big Trouble in Little China&lt;/em&gt;&lt;br&gt;&copy;1986 &lt;a href="http://www.foxmovies.com/"&gt;20th Century Fox&lt;/a&gt;&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;People:&lt;ol&gt;&lt;li&gt;Susan&lt;/li&gt;&lt;li&gt;Catalina&lt;/li&gt;&lt;li&gt;Diego&lt;/li&gt;&lt;li&gt;Bob&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;There are less than ten people.&lt;/p&gt;</code></pre><a href=http://rexsite.azureedge.net/razor-minification/image.png><img alt="Rendered Razor page" src=data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 class=lazy data-src=http://rexsite.azureedge.net/razor-minification/image.png style=max-width:100%;padding-bottom:20px></a> <a id=additional-resources></a><h2><svg aria-hidden=true height=16 version=1.1 viewbox="0 0 16 16" width=16><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg> <a href=#additional-resources class=nostyle>Additional Resources</a></h2><ul><li><a href="https://docs.microsoft.com/aspnet/core/mvc/razor-pages/">Introduction to Razor Pages in ASP.NET Core</a><li><a href="https://www.nuget.org/packages/WebMarkupMin.Core/">WebMarkupMin.Core at nuget.org</a><li><a href=https://github.com/Taritsyn/WebMarkupMin/wiki>WebMarkupMin.Core Wiki at GitHub</a></ul><a id=acknowledgements></a><h2><svg aria-hidden=true height=16 version=1.1 viewbox="0 0 16 16" width=16><path d="M4 9h1v1h-1c-1.5 0-3-1.69-3-3.5s1.55-3.5 3-3.5h4c1.45 0 3 1.69 3 3.5 0 1.41-0.91 2.72-2 3.25v-1.16c0.58-0.45 1-1.27 1-2.09 0-1.28-1.02-2.5-2-2.5H4c-0.98 0-2 1.22-2 2.5s1 2.5 2 2.5z m9-3h-1v1h1c1 0 2 1.22 2 2.5s-1.02 2.5-2 2.5H9c-0.98 0-2-1.22-2-2.5 0-0.83 0.42-1.64 1-2.09v-1.16c-1.09 0.53-2 1.84-2 3.25 0 1.81 1.55 3.5 3 3.5h4c1.45 0 3-1.69 3-3.5s-1.5-3.5-3-3.5z"></path></svg> <a href=#acknowledgements class=nostyle>Acknowledgements</a></h2><ul><li>Ajay Bhargav Baaskaran (@ajaybhargavb), Software Engineer, Microsoft <a href=https://github.com/ajaybhargavb>GitHub</a> <a href="https://www.linkedin.com/in/ajaybhargavb/?ppe=1">Linkedin</a><li>Kévin Chalet (@PinpointTownes/@pinpoint) <a href=https://github.com/PinpointTownes>GitHub</a> <a href="http://kevinchalet.com/">Blog <a href=https://twitter.com/PinpointTownes>Twitter</a></a><li>Bart Calixto (@bartmax) <a href=https://github.com/Bartmax>GitHub</a> <a href=https://twitter.com/bartmax>Twitter</a><li>Rob Schoenaker <a href=https://github.com/RobSchoenaker>GitHub</a></ul></article><hr><a class=nostyle style=margin-top:12px;float:right href=https://github.com/guardrex/guardrex.com><img src="https://ci.appveyor.com/api/projects/status/idjmmibiqgta0ox0/branch/master?svg=true" alt="Project Badge" width=140></a><table id=social_bottom><tbody><tr><td><a href="https://twitter.com/home?status=Check%20out%20%40guardrex%20blog%20post%20Razor%20Compile%2Dtime%20Minification"><svg role=img aria-labelledby="twitter twitter_desc" height=28 width=28 xmlns=http://www.w3.org/2000/svg viewBox="0 0 28 28"><title id=twitter>Tweet</title><desc id=twitter_desc>Share on Twitter</desc><path fill=#26c4f1 d="M24.253 8.756C24.69 17.08 18.297 24.182 9.97 24.62a15.093 15.093 0 0 1-8.86-2.32c2.702.18 5.375-.648 7.507-2.32a5.417 5.417 0 0 1-4.49-3.64c.802.13 1.62.077 2.4-.154a5.416 5.416 0 0 1-4.412-5.11 5.43 5.43 0 0 0 2.168.387A5.416 5.416 0 0 1 2.89 4.498a15.09 15.09 0 0 0 10.913 5.573 5.185 5.185 0 0 1 3.434-6.48 5.18 5.18 0 0 1 5.546 1.682 9.076 9.076 0 0 0 3.33-1.317 5.038 5.038 0 0 1-2.4 2.942 9.068 9.068 0 0 0 3.02-.85 5.05 5.05 0 0 1-2.48 2.71z" /></svg></a><td><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A//www.guardrex.com/post/razor-minification.html"><svg role=img aria-labelledby="facebook facebook_desc" height=29 width=29 xmlns=http://www.w3.org/2000/svg viewBox="0 0 29 29"><title id=facebook>Facebook</title><desc id=facebook_desc>Share on Facebook</desc><path fill=#306199 d="M26.4 0H2.6C1.714 0 0 1.715 0 2.6v23.8c0 .884 1.715 2.6 2.6 2.6h12.393V17.988h-3.996v-3.98h3.997v-3.062c0-3.746 2.835-5.97 6.177-5.97 1.6 0 2.444.173 2.845.226v3.792H21.18c-1.817 0-2.156.9-2.156 2.168v2.847h5.045l-.66 3.978h-4.386V29H26.4c.884 0 2.6-1.716 2.6-2.6V2.6c0-.885-1.716-2.6-2.6-2.6z" /></svg></a><td><a href="https://plus.google.com/share?url=http%3A//www.guardrex.com/post/razor-minification.html"><svg role=img aria-labelledby="google google_desc" xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 0 24 24"><title id=google>Google+</title><desc id=google_desc>Share on Google+</desc><path fill=#e93f2e d="M21 8.29h-1.95v2.6h-2.6v1.82h2.6v2.6H21v-2.6h2.6v-1.885H21V8.29zM7.614 10.306v2.925h3.9c-.26 1.69-1.755 2.925-3.9 2.925-2.34 0-4.29-2.016-4.29-4.354s1.885-4.353 4.29-4.353c1.104 0 2.014.326 2.794 1.105l2.08-2.08c-1.3-1.17-2.924-1.883-4.874-1.883C3.65 4.586.4 7.835.4 11.8s3.25 7.212 7.214 7.212c4.224 0 6.953-2.988 6.953-7.082 0-.52-.065-1.104-.13-1.624H7.614z"></path></svg></a><td><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3A//www.guardrex.com/post/razor-minification.html&amp;title=Razor%20Compile%2Dtime%20Minification%20for%20ASP%2ENET%20Core%202%2E0&amp;summary=Check%20out%20%40guardrex%20blog%20post%20Razor%20Compile%2Dtime%20Minification&amp;source=!social_source"><svg role=img aria-labelledby="linkedin linkedin_desc" xmlns=http://www.w3.org/2000/svg width=28 height=28 viewBox="0 0 28 28"><title id=linkedin>Linkedin</title><desc id=linkedin_desc>Share on Linkedin</desc><path fill=#007bb6 d="M25.424 15.887v8.447h-4.896v-7.882c0-1.98-.71-3.33-2.48-3.33-1.354 0-2.158.91-2.514 1.802-.13.315-.162.753-.162 1.194v8.216h-4.9s.067-13.35 0-14.73h4.9v2.087c-.01.017-.023.033-.033.05h.032v-.05c.65-1.002 1.812-2.435 4.414-2.435 3.222 0 5.638 2.106 5.638 6.632zM5.348 2.5c-1.676 0-2.772 1.093-2.772 2.54 0 1.42 1.066 2.538 2.717 2.546h.032c1.71 0 2.77-1.132 2.77-2.546C8.056 3.593 7.02 2.5 5.344 2.5h.005zm-2.48 21.834h4.896V9.604H2.867v14.73z"></path></svg></a></table><hr><div id=disqus_thread></div><footer><div class=container style="padding:20px 0;text-align:center"><p>Copyright &copy;2017 Luke Latham All Rights Reserved.</div></footer></div><script>(function(){'use strict';if(navigator.userAgent.match(/IEMobile\/10\.0/)){var msViewportStyle=document.createElement('style')
msViewportStyle.appendChild(document.createTextNode('@-ms-viewport{width:auto!important}'))
document.querySelector('head').appendChild(msViewportStyle)}
var colors=new Array([62,35,255],[60,255,60],[255,35,98],[45,175,230],[255,0,255],[255,128,0]);var step=0;var colorIndices=[0,1,2,3];var gradientSpeed=0.002;function updateGradient()
{var c0_0=colors[colorIndices[0]];var c0_1=colors[colorIndices[1]];var c1_0=colors[colorIndices[2]];var c1_1=colors[colorIndices[3]];var istep=1-step;var r1=Math.round(istep*c0_0[0]+step*c0_1[0]);var g1=Math.round(istep*c0_0[1]+step*c0_1[1]);var b1=Math.round(istep*c0_0[2]+step*c0_1[2]);var color1="rgb("+r1+","+g1+","+b1+")";var r2=Math.round(istep*c1_0[0]+step*c1_1[0]);var g2=Math.round(istep*c1_0[1]+step*c1_1[1]);var b2=Math.round(istep*c1_0[2]+step*c1_1[2]);var color2="rgb("+r2+","+g2+","+b2+")";document.getElementById("gradient").style.background="-webkit-gradient(linear, left top, right top, from("+color1+"), to("+color2+"))";document.getElementById("gradient").style.background="-moz-linear-gradient(left, "+color1+" 0%, "+color2+" 100%)";step+=gradientSpeed;if(step>=1){step%=1;colorIndices[0]=colorIndices[1];colorIndices[2]=colorIndices[3];colorIndices[1]=(colorIndices[1]+Math.floor(1+Math.random()*(colors.length-1)))%colors.length;colorIndices[3]=(colorIndices[3]+Math.floor(1+Math.random()*(colors.length-1)))%colors.length;}}
if(document.getElementById("gradient")!=null){document.getElementById("header_container").style.borderBottom="none";document.getElementById("social_top").style.display="none";document.getElementById("disqus_thread").style.display="none";setInterval(updateGradient,10);}
registerListener('load',setLazy);registerListener('load',lazyLoad);registerListener('scroll',lazyLoad);var lazy=[];function setLazy(){lazy=document.getElementsByClassName('lazy');console.log('Found '+lazy.length+' lazy images');}
function lazyLoad(){for(var i=0;i<lazy.length;i++){if(isInViewport(lazy[i])){if(lazy[i].getAttribute('data-src')){lazy[i].src=lazy[i].getAttribute('data-src');lazy[i].removeAttribute('data-src');}}}
cleanLazy();}
function cleanLazy(){lazy=Array.prototype.filter.call(lazy,function(l){return l.getAttribute('data-src');});}
function isInViewport(el){var rect=el.getBoundingClientRect();return(rect.bottom>=0&&rect.right>=0&&rect.top<=(window.innerHeight||document.documentElement.clientHeight)&&rect.left<=(window.innerWidth||document.documentElement.clientWidth));}
function registerListener(event,func){if(window.addEventListener){window.addEventListener(event,func)}else{window.attachEvent('on'+event,func)}}
var d=document,s=d.createElement('script');s.src='https://guardrex.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();var _self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{},Prism=function(){var e=/\blang(?:uage)?-(\w+)\b/i,t=0,n=_self.Prism={manual:_self.Prism&&_self.Prism.manual,util:{encode:function(e){return e instanceof a?new a(e.type,n.util.encode(e.content),e.alias):"Array"===n.util.type(e)?e.map(n.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++t}),e.__id},clone:function(e){var t=n.util.type(e);switch(t){case"Object":var a={};for(var r in e)e.hasOwnProperty(r)&&(a[r]=n.util.clone(e[r]));return a;case"Array":return e.map&&e.map(function(e){return n.util.clone(e)})}return e}},languages:{extend:function(e,t){var a=n.util.clone(n.languages[e]);for(var r in t)a[r]=t[r];return a},insertBefore:function(e,t,a,r){r=r||n.languages;var i=r[e];if(2==arguments.length){a=arguments[1];for(var l in a)a.hasOwnProperty(l)&&(i[l]=a[l]);return i}var o={};for(var s in i)if(i.hasOwnProperty(s)){if(s==t)for(var l in a)a.hasOwnProperty(l)&&(o[l]=a[l]);o[s]=i[s]}return n.languages.DFS(n.languages,function(t,n){n===r[e]&&t!=e&&(this[t]=o)}),r[e]=o},DFS:function(e,t,a,r){r=r||{};for(var i in e)e.hasOwnProperty(i)&&(t.call(e,i,e[i],a||i),"Object"!==n.util.type(e[i])||r[n.util.objId(e[i])]?"Array"!==n.util.type(e[i])||r[n.util.objId(e[i])]||(r[n.util.objId(e[i])]=!0,n.languages.DFS(e[i],t,i,r)):(r[n.util.objId(e[i])]=!0,n.languages.DFS(e[i],t,null,r)))}},plugins:{},highlightAll:function(e,t){var a={callback:t,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};n.hooks.run("before-highlightall",a);for(var r,i=a.elements||document.querySelectorAll(a.selector),l=0;r=i[l++];)n.highlightElement(r,e===!0,a.callback)},highlightElement:function(t,a,r){for(var i,l,o=t;o&&!e.test(o.className);)o=o.parentNode;o&&(i=(o.className.match(e)||[,""])[1].toLowerCase(),l=n.languages[i]),t.className=t.className.replace(e,"").replace(/\s+/g," ")+" language-"+i,o=t.parentNode,/pre/i.test(o.nodeName)&&(o.className=o.className.replace(e,"").replace(/\s+/g," ")+" language-"+i);var s=t.textContent,u={element:t,language:i,grammar:l,code:s};if(n.hooks.run("before-sanity-check",u),!u.code||!u.grammar)return u.code&&(n.hooks.run("before-highlight",u),u.element.textContent=u.code,n.hooks.run("after-highlight",u)),n.hooks.run("complete",u),void 0;if(n.hooks.run("before-highlight",u),a&&_self.Worker){var g=new Worker(n.filename);g.onmessage=function(e){u.highlightedCode=e.data,n.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(u.element),n.hooks.run("after-highlight",u),n.hooks.run("complete",u)},g.postMessage(JSON.stringify({language:u.language,code:u.code,immediateClose:!0}))}else u.highlightedCode=n.highlight(u.code,u.grammar,u.language),n.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(t),n.hooks.run("after-highlight",u),n.hooks.run("complete",u)},highlight:function(e,t,r){var i=n.tokenize(e,t);return a.stringify(n.util.encode(i),r)},matchGrammar:function(e,t,a,r,i,l,o){var s=n.Token;for(var u in a)if(a.hasOwnProperty(u)&&a[u]){if(u==o)return;var g=a[u];g="Array"===n.util.type(g)?g:[g];for(var c=0;c<g.length;++c){var h=g[c],f=h.inside,d=!!h.lookbehind,m=!!h.greedy,p=0,y=h.alias;if(m&&!h.pattern.global){var v=h.pattern.toString().match(/[imuy]*$/)[0];h.pattern=RegExp(h.pattern.source,v+"g")}h=h.pattern||h;for(var b=r,k=i;b<t.length;k+=t[b].length,++b){var w=t[b];if(t.length>e.length)return;if(!(w instanceof s)){h.lastIndex=0;var _=h.exec(w),P=1;if(!_&&m&&b!=t.length-1){if(h.lastIndex=k,_=h.exec(e),!_)break;for(var A=_.index+(d?_[1].length:0),j=_.index+_[0].length,x=b,O=k,S=t.length;S>x&&(j>O||!t[x].type&&!t[x-1].greedy);++x)O+=t[x].length,A>=O&&(++b,k=O);if(t[b]instanceof s||t[x-1].greedy)continue;P=x-b,w=e.slice(k,O),_.index-=k}if(_){d&&(p=_[1].length);var A=_.index+p,_=_[0].slice(p),j=A+_.length,N=w.slice(0,A),C=w.slice(j),E=[b,P];N&&(++b,k+=N.length,E.push(N));var L=new s(u,f?n.tokenize(_,f):_,y,_,m);if(E.push(L),C&&E.push(C),Array.prototype.splice.apply(t,E),1!=P&&n.matchGrammar(e,t,a,b,k,!0,u),l)break}else if(l)break}}}}},tokenize:function(e,t){var a=[e],r=t.rest;if(r){for(var i in r)t[i]=r[i];delete t.rest}return n.matchGrammar(e,a,t,0,0,!1),a},hooks:{all:{},add:function(e,t){var a=n.hooks.all;a[e]=a[e]||[],a[e].push(t)},run:function(e,t){var a=n.hooks.all[e];if(a&&a.length)for(var r,i=0;r=a[i++];)r(t)}}},a=n.Token=function(e,t,n,a,r){this.type=e,this.content=t,this.alias=n,this.length=0|(a||"").length,this.greedy=!!r};if(a.stringify=function(e,t,r){if("string"==typeof e)return e;if("Array"===n.util.type(e))return e.map(function(n){return a.stringify(n,t,e)}).join("");var i={type:e.type,content:a.stringify(e.content,t,r),tag:"span",classes:["token",e.type],attributes:{},language:t,parent:r};if("comment"==i.type&&(i.attributes.spellcheck="true"),e.alias){var l="Array"===n.util.type(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(i.classes,l)}n.hooks.run("wrap",i);var o=Object.keys(i.attributes).map(function(e){return e+'="'+(i.attributes[e]||"").replace(/"/g,"&quot;")+'"'}).join(" ");return"<"+i.tag+' class="'+i.classes.join(" ")+'"'+(o?" "+o:"")+">"+i.content+"</"+i.tag+">"},!_self.document)return _self.addEventListener?(_self.addEventListener("message",function(e){var t=JSON.parse(e.data),a=t.language,r=t.code,i=t.immediateClose;_self.postMessage(n.highlight(r,n.languages[a],a)),i&&_self.close()},!1),_self.Prism):_self.Prism;var r=document.currentScript||[].slice.call(document.getElementsByTagName("script")).pop();return r&&(n.filename=r.src,!document.addEventListener||n.manual||r.hasAttribute("data-manual")||("loading"!==document.readyState?window.requestAnimationFrame?window.requestAnimationFrame(n.highlightAll):window.setTimeout(n.highlightAll,16):document.addEventListener("DOMContentLoaded",n.highlightAll))),_self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism),"undefined"!=typeof global&&(global.Prism=Prism);Prism.languages.markup={comment:/<!--[\s\S]*?-->/,prolog:/<\?[\s\S]+?\?>/,doctype:/<!DOCTYPE[\s\S]+?>/i,cdata:/<!\[CDATA\[[\s\S]*?]]>/i,tag:{pattern:/<\/?(?!\d)[^\s>\/=$<]+(?:\s+[^\s>\/=]+(?:=(?:("|')(?:\\\1|\\?(?!\1)[\s\S])*\1|[^\s'">=]+))?)*\s*\/?>/i,inside:{tag:{pattern:/^<\/?[^\s>\/]+/i,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"attr-value":{pattern:/=(?:('|")[\s\S]*?(\1)|[^\s>]+)/i,inside:{punctuation:/[=>"']/}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:/&#?[\da-z]{1,8};/i},Prism.languages.markup.tag.inside["attr-value"].inside.entity=Prism.languages.markup.entity,Prism.hooks.add("wrap",function(a){"entity"===a.type&&(a.attributes.title=a.content.replace(/&amp;/,"&"))}),Prism.languages.xml=Prism.languages.markup,Prism.languages.html=Prism.languages.markup,Prism.languages.mathml=Prism.languages.markup,Prism.languages.svg=Prism.languages.markup;Prism.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:/@[\w-]+?.*?(;|(?=\s*\{))/i,inside:{rule:/@[\w-]+/}},url:/url\((?:(["'])(\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1|.*?)\)/i,selector:/[^\{\}\s][^\{\};]*?(?=\s*\{)/,string:{pattern:/("|')(\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},property:/(\b|\B)[\w-]+(?=\s*:)/i,important:/\B!important\b/i,"function":/[-a-z0-9]+(?=\()/i,punctuation:/[(){};:]/},Prism.languages.css.atrule.inside.rest=Prism.util.clone(Prism.languages.css),Prism.languages.markup&&(Prism.languages.insertBefore("markup","tag",{style:{pattern:/(<style[\s\S]*?>)[\s\S]*?(?=<\/style>)/i,lookbehind:!0,inside:Prism.languages.css,alias:"language-css"}}),Prism.languages.insertBefore("inside","attr-value",{"style-attr":{pattern:/\s*style=("|').*?\1/i,inside:{"attr-name":{pattern:/^\s*style/i,inside:Prism.languages.markup.tag.inside},punctuation:/^\s*=\s*['"]|['"]\s*$/,"attr-value":{pattern:/.+/i,inside:Prism.languages.css}},alias:"language-css"}},Prism.languages.markup.tag));Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?\*\//,lookbehind:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0}],string:{pattern:/(["'])(\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/((?:\b(?:class|interface|extends|implements|trait|instanceof|new)\s+)|(?:catch\s+\())[a-z0-9_\.\\]+/i,lookbehind:!0,inside:{punctuation:/(\.|\\)/}},keyword:/\b(if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,"boolean":/\b(true|false)\b/,"function":/[a-z0-9_]+(?=\()/i,number:/\b-?(?:0x[\da-f]+|\d*\.?\d+(?:e[+-]?\d+)?)\b/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*|\/|~|\^|%/,punctuation:/[{}[\];(),.:]/};Prism.languages.javascript=Prism.languages.extend("clike",{keyword:/\b(as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield)\b/,number:/\b-?(0[xX][\dA-Fa-f]+|0[bB][01]+|0[oO][0-7]+|\d*\.?\d+([Ee][+-]?\d+)?|NaN|Infinity)\b/,"function":/[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*(?=\()/i,operator:/-[-=]?|\+[+=]?|!=?=?|<<?=?|>>?>?=?|=(?:==?|>)?|&[&=]?|\|[|=]?|\*\*?=?|\/=?|~|\^=?|%=?|\?|\.{3}/}),Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:/(^|[^\/])\/(?!\/)(\[[^\]\r\n]+]|\\.|[^\/\\\[\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})]))/,lookbehind:!0,greedy:!0}}),Prism.languages.insertBefore("javascript","string",{"template-string":{pattern:/`(?:\\\\|\\?[^\\])*?`/,greedy:!0,inside:{interpolation:{pattern:/\$\{[^}]+\}/,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Prism.languages.javascript}},string:/[\s\S]+/}}}),Prism.languages.markup&&Prism.languages.insertBefore("markup","tag",{script:{pattern:/(<script[\s\S]*?>)[\s\S]*?(?=<\/script>)/i,lookbehind:!0,inside:Prism.languages.javascript,alias:"language-javascript"}}),Prism.languages.js=Prism.languages.javascript;Prism.languages.csharp=Prism.languages.extend("clike",{keyword:/\b(abstract|as|async|await|base|bool|break|byte|case|catch|char|checked|class|const|continue|decimal|default|delegate|do|double|else|enum|event|explicit|extern|false|finally|fixed|float|for|foreach|goto|if|implicit|in|int|interface|internal|is|lock|long|namespace|new|null|object|operator|out|override|params|private|protected|public|readonly|ref|return|sbyte|sealed|short|sizeof|stackalloc|static|string|struct|switch|this|throw|true|try|typeof|uint|ulong|unchecked|unsafe|ushort|using|virtual|void|volatile|while|add|alias|ascending|async|await|descending|dynamic|from|get|global|group|into|join|let|orderby|partial|remove|select|set|value|var|where|yield)\b/,string:[{pattern:/@("|')(\1\1|\\\1|\\?(?!\1)[\s\S])*\1/,greedy:!0},{pattern:/("|')(\\?.)*?\1/,greedy:!0}],number:/\b-?(0x[\da-f]+|\d*\.?\d+f?)\b/i}),Prism.languages.insertBefore("csharp","keyword",{"generic-method":{pattern:/[a-z0-9_]+\s*<[^>\r\n]+?>\s*(?=\()/i,alias:"function",inside:{keyword:Prism.languages.csharp.keyword,punctuation:/[<>(),.:]/}},preprocessor:{pattern:/(^\s*)#.*/m,lookbehind:!0,alias:"property",inside:{directive:{pattern:/(\s*#)\b(define|elif|else|endif|endregion|error|if|line|pragma|region|undef|warning)\b/,lookbehind:!0,alias:"keyword"}}}});Prism.languages.powershell={comment:[{pattern:/(^|[^`])<#[\s\S]*?#>/,lookbehind:!0},{pattern:/(^|[^`])#.*/,lookbehind:!0}],string:[{pattern:/"(`?[\s\S])*?"/,greedy:!0,inside:{"function":{pattern:/[^`]\$\(.*?\)/,inside:{}}}},{pattern:/'([^']|'')*'/,greedy:!0}],namespace:/\[[a-z][\s\S]*?\]/i,"boolean":/\$(true|false)\b/i,variable:/\$\w+\b/i,"function":[/\b(Add-(Computer|Content|History|Member|PSSnapin|Type)|Checkpoint-Computer|Clear-(Content|EventLog|History|Item|ItemProperty|Variable)|Compare-Object|Complete-Transaction|Connect-PSSession|ConvertFrom-(Csv|Json|StringData)|Convert-Path|ConvertTo-(Csv|Html|Json|Xml)|Copy-(Item|ItemProperty)|Debug-Process|Disable-(ComputerRestore|PSBreakpoint|PSRemoting|PSSessionConfiguration)|Disconnect-PSSession|Enable-(ComputerRestore|PSBreakpoint|PSRemoting|PSSessionConfiguration)|Enter-PSSession|Exit-PSSession|Export-(Alias|Clixml|Console|Csv|FormatData|ModuleMember|PSSession)|ForEach-Object|Format-(Custom|List|Table|Wide)|Get-(Alias|ChildItem|Command|ComputerRestorePoint|Content|ControlPanelItem|Culture|Date|Event|EventLog|EventSubscriber|FormatData|Help|History|Host|HotFix|Item|ItemProperty|Job|Location|Member|Module|Process|PSBreakpoint|PSCallStack|PSDrive|PSProvider|PSSession|PSSessionConfiguration|PSSnapin|Random|Service|TraceSource|Transaction|TypeData|UICulture|Unique|Variable|WmiObject)|Group-Object|Import-(Alias|Clixml|Csv|LocalizedData|Module|PSSession)|Invoke-(Command|Expression|History|Item|RestMethod|WebRequest|WmiMethod)|Join-Path|Limit-EventLog|Measure-(Command|Object)|Move-(Item|ItemProperty)|New-(Alias|Event|EventLog|Item|ItemProperty|Module|ModuleManifest|Object|PSDrive|PSSession|PSSessionConfigurationFile|PSSessionOption|PSTransportOption|Service|TimeSpan|Variable|WebServiceProxy)|Out-(Default|File|GridView|Host|Null|Printer|String)|Pop-Location|Push-Location|Read-Host|Receive-(Job|PSSession)|Register-(EngineEvent|ObjectEvent|PSSessionConfiguration|WmiEvent)|Remove-(Computer|Event|EventLog|Item|ItemProperty|Job|Module|PSBreakpoint|PSDrive|PSSession|PSSnapin|TypeData|Variable|WmiObject)|Rename-(Computer|Item|ItemProperty)|Reset-ComputerMachinePassword|Resolve-Path|Restart-(Computer|Service)|Restore-Computer|Resume-(Job|Service)|Save-Help|Select-(Object|String|Xml)|Send-MailMessage|Set-(Alias|Content|Date|Item|ItemProperty|Location|PSBreakpoint|PSDebug|PSSessionConfiguration|Service|StrictMode|TraceSource|Variable|WmiInstance)|Show-(Command|ControlPanelItem|EventLog)|Sort-Object|Split-Path|Start-(Job|Process|Service|Sleep|Transaction)|Stop-(Computer|Job|Process|Service)|Suspend-(Job|Service)|Tee-Object|Test-(ComputerSecureChannel|Connection|ModuleManifest|Path|PSSessionConfigurationFile)|Trace-Command|Unblock-File|Undo-Transaction|Unregister-(Event|PSSessionConfiguration)|Update-(FormatData|Help|List|TypeData)|Use-Transaction|Wait-(Event|Job|Process)|Where-Object|Write-(Debug|Error|EventLog|Host|Output|Progress|Verbose|Warning))\b/i,/\b(ac|cat|chdir|clc|cli|clp|clv|compare|copy|cp|cpi|cpp|cvpa|dbp|del|diff|dir|ebp|echo|epal|epcsv|epsn|erase|fc|fl|ft|fw|gal|gbp|gc|gci|gcs|gdr|gi|gl|gm|gp|gps|group|gsv|gu|gv|gwmi|iex|ii|ipal|ipcsv|ipsn|irm|iwmi|iwr|kill|lp|ls|measure|mi|mount|move|mp|mv|nal|ndr|ni|nv|ogv|popd|ps|pushd|pwd|rbp|rd|rdr|ren|ri|rm|rmdir|rni|rnp|rp|rv|rvpa|rwmi|sal|saps|sasv|sbp|sc|select|set|shcm|si|sl|sleep|sls|sort|sp|spps|spsv|start|sv|swmi|tee|trcm|type|write)\b/i],keyword:/\b(Begin|Break|Catch|Class|Continue|Data|Define|Do|DynamicParam|Else|ElseIf|End|Exit|Filter|Finally|For|ForEach|From|Function|If|InlineScript|Parallel|Param|Process|Return|Sequence|Switch|Throw|Trap|Try|Until|Using|Var|While|Workflow)\b/i,operator:{pattern:/(\W?)(!|-(eq|ne|gt|ge|lt|le|sh[lr]|not|b?(and|x?or)|(Not)?(Like|Match|Contains|In)|Replace|Join|is(Not)?|as)\b|-[-=]?|\+[+=]?|[*\/%]=?)/i,lookbehind:!0},punctuation:/[|{}[\];(),.]/},Prism.languages.powershell.string[0].inside.boolean=Prism.languages.powershell.boolean,Prism.languages.powershell.string[0].inside.variable=Prism.languages.powershell.variable,Prism.languages.powershell.string[0].inside.function.inside=Prism.util.clone(Prism.languages.powershell);</script>